/* стартунть сервис */
sudo service postgresql start
/* содать базу данных под админом */
create database farmacy;
/* создать под админом пользователя - именно его данные будет внесены для подключения к бд */
create user dealer with password 'dealer';
grant all privileges on database farmacy to dealer;
/*войти в постгрес под dealer */
psql -h localhost farmacy dealer;

CREATE TABLE IF NOT EXISTS pharmacist (
 id_pharmacist serial PRIMARY KEY,
 name VARCHAR(45)  NOT NULL UNIQUE,
 password VARCHAR(45)  NOT NULL,
 user_group VARCHAR(45) NOT NULL,
 CHECK (user_group IN ('employee','admin'))
);

CREATE TABLE IF NOT EXISTS drug (
 id_drug serial PRIMARY KEY,
 drug_name VARCHAR(45) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS drug_store (
 id_drug_store serial PRIMARY KEY,
 id_drug INT NOT NULL, FOREIGN KEY (id_drug) REFERENCES drug(id_drug),
 price numeric (18,2) NOT NULL,
 amount numeric (18,3) NOT NULL,
 CHECK (price >= 0),
 CHECK (amount >= 0)
);

CREATE TABLE IF NOT EXISTS client (
  id_client serial PRIMARY KEY,
  name VARCHAR(45) NOT NULL UNIQUE,
  password VARCHAR(45) NOT NULL,
  user_group VARCHAR(45) NOT NULL,
  CHECK (user_group IN ('user'))
);

CREATE TABLE IF NOT EXISTS order_t (
 id_order serial PRIMARY KEY,
 id_client INT NOT NULL, FOREIGN KEY (id_client) REFERENCES client(id_client)
);

CREATE TABLE  IF NOT EXISTS order_items (
 id_items serial PRIMARY KEY,
 id_client INT NOT NULL, FOREIGN KEY (id_client) REFERENCES client (id_client),
 id_pharmacist INT NOT NULL, FOREIGN KEY (id_pharmacist) REFERENCES pharmacist (id_pharmacist),
 id_drug INT NOT NULL, FOREIGN KEY (id_drug) REFERENCES drug (id_drug),
 price numeric (18,2) NOT NULL,
 amount numeric (18,3) NOT NULL,
 CHECK (price >= 0),
 CHECK (amount >= 0)
);


/* insert */
insert into client (name,password,user_group) values ('lisa','1234','user');
insert into client (name,password,user_group) values ('masha','1234','user');
insert into client (name,password,user_group) values ('tasha','1234','user');
insert into client (name,password,user_group) values ('rome','1234','user');

insert into pharmacist (name,password,user_group) values ('saller1','1234','employee');
insert into pharmacist (name,password,user_group) values ('saller2','1234','employee');

insert into drug (drug_name) values('Allegra');
insert into drug (drug_name) values('Concerta');
insert into drug (drug_name) values('Latisse');
insert into drug (drug_name) values('Levitra');
insert into drug (drug_name) values('Lexapro');

insert into drug_store (id_drug,price,amount) values ((SELECT id_drug from drug where drug_name ='Allegra'),15.40, 500);
insert into drug_store (id_drug,price,amount) values ((SELECT id_drug from drug where drug_name ='Concerta'),10.00, 45);
insert into drug_store (id_drug,price,amount) values ((SELECT id_drug from drug where drug_name ='Latisse'),100.00, 181);
insert into drug_store (id_drug,price,amount) values ((SELECT id_drug from drug where drug_name ='Levitra'),28.30, 15.30);
insert into drug_store (id_drug,price,amount) values ((SELECT id_drug from drug where drug_name ='Lexapro'),112.11, 100);

/* для удаления таблиц */
drop table client,drug,drug_store,order_items,order_t,pharmacist;
